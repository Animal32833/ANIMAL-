<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIMAL - Nutrición Personalizada</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Librería para gráficas de progreso -->
    <script src="script.js" defer></script> <!-- Asegúrate de que el script se cargue correctamente -->

    <!-- Estilos CSS Incrustados -->
    <style>
        /* General Styles */
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh; /* Esto asegura que el contenido esté centrado verticalmente */
        }

        /* Header and Logo */
        header {
            padding: 20px;
            background-color: #121212;
        }

        .logo img {
            width: 150px;
        }

        h1 {
            color: #39FF14; /* Verde neón */
            margin: 20px 0;
        }

        #hero h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        #hero p {
            font-size: 1.2rem;
        }

        /* Form Section */
        #form-section {
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #333;
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px; /* Limita el tamaño máximo del formulario */
        }

        label, input, select {
            display: block;
            width: 100%;
            margin: 10px 0;
        }

        input, select {
            padding: 10px;
            border: none;
            border-radius: 5px;
        }

        button {
            background-color: #39FF14;
            color: black;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
        }

        button:hover {
            background-color: #32cd32;
        }

        /* Gallery Section */
        #gallery {
            padding: 40px;
        }

        .image-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .image-container img {
            width: 30%;
            margin: 10px;
            border-radius: 10px;
        }

        /* Footer */
        footer {
            background-color: #121212;
            padding: 20px;
            color: #777;
        }

        footer p {
            margin: 0;
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <img src="logo-animal.png" alt="Animal Logo">
        </div>
        <h1>ANIMAL - Nutrición Personalizada</h1>
    </header>

    <!-- Sección de bienvenida -->
    <section id="hero">
        <h2>Bienvenido a tu plan personalizado de nutrición y entrenamiento</h2>
        <p>Introduce tus datos para obtener un plan acorde a tus objetivos y necesidades.</p>
    </section>

    <!-- Formulario de Nutrición -->
    <section id="form-section">
        <form id="nutricionForm">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" required>

            <label for="edad">Edad:</label>
            <input type="number" id="edad" required>

            <label for="peso">Peso (kg):</label>
            <input type="number" id="peso" required>

            <label for="altura">Altura (cm):</label>
            <input type="number" id="altura" required>

            <label for="genero">Género:</label>
            <select id="genero" required>
                <option value="masculino">Masculino</option>
                <option value="femenino">Femenino</option>
            </select>

            <label for="objetivo">Objetivo:</label>
            <select id="objetivo" required>
                <option value="mantener_peso">Mantener Peso</option>
                <option value="perder_peso">Perder Peso</option>
                <option value="ganar_masa">Ganar Masa Muscular</option>
            </select>

            <label for="restricciones">Restricciones alimenticias (opcional):</label>
            <input type="text" id="restricciones" placeholder="Ej. sin gluten, vegetariano">

            <button type="submit">Generar Opciones de Comida</button>
        </form>

        <!-- Mostrar la recomendación de agua -->
        <p id="resultadoAgua"></p>
    </section>

    <!-- Opciones de Menú generadas -->
    <section id="menus">
        <h2>Opciones de Menú</h2>
        <div id="resultadoDieta"></div>
    </section>

    <!-- Seguimiento de Progreso -->
    <section id="progreso">
        <h2>Seguimiento de Progreso</h2>
        <form id="progresoForm">
            <label for="dni">DNI:</label>
            <input type="text" id="dni" required>

            <label for="peso">Peso (kg):</label>
            <input type="number" id="peso" required>

            <label for="medidaCintura">Medida de Cintura (cm):</label>
            <input type="number" id="medidaCintura" required>

            <label for="medidaCadera">Medida de Cadera (cm):</label>
            <input type="number" id="medidaCadera">

            <button type="submit">Registrar Progreso</button>
        </form>

        <!-- Gráfico de Progreso -->
        <canvas id="graficoProgreso"></canvas>
    </section>

    <!-- Cargar Progreso por DNI -->
    <section id="cargarProgreso">
        <h2>Cargar Progreso por DNI</h2>
        <form id="cargarProgresoForm">
            <label for="dniCargar">DNI:</label>
            <input type="text" id="dniCargar" required>
            <button type="submit">Cargar Progreso</button>
        </form>
    </section>

    <!-- JavaScript -->
    <script>
        // Variable global para almacenar el gráfico de progreso
        let graficoProgreso;

        // Función para calcular la TMB (Tasa Metabólica Basal)
        function calcularTMB(peso, altura, edad, genero) {
            if (genero === 'masculino') {
                return Math.round(88.36 + (13.4 * peso) + (4.8 * altura) - (5.7 * edad));
            } else {
                return Math.round(447.6 + (9.2 * peso) + (3.1 * altura) - (4.3 * edad));
            }
        }

        // Función para calcular la ingesta de agua recomendada
        function calcularIngestaAgua(peso) {
            return (peso * 0.035).toFixed(2); // 35 ml por kg de peso
        }

        // Base de datos de recetas con restricciones alimenticias y objetivos de nutrición
        const recetas = [
            { nombre: "Avena con Frutas", calorias: 350, proteinas: 10, carbohidratos: 60, grasas: 5, restricciones: ["sin gluten", "vegetariano"], tipo: "desayuno", objetivos: ["mantener_peso", "ganar_masa"] },
            { nombre: "Tostadas con Aguacate", calorias: 250, proteinas: 5, carbohidratos: 30, grasas: 15, restricciones: ["vegano", "sin gluten"], tipo: "desayuno", objetivos: ["mantener_peso", "perder_peso"] },
            // Puedes agregar más recetas según lo necesites...
        ];

        // Función para generar automáticamente el menú completo del día
        function generarMenuAutomatico(caloriasDiarias, restriccionesUsuario, objetivo) {
            const comidasDiarias = ['desayuno', 'almuerzo', 'cena', 'snack'];
            let menuCompleto = `<h3>Menú del día:</h3><ul>`;

            comidasDiarias.forEach(comida => {
                const recetasFiltradas = recetas.filter(receta => {
                    const cumpleRestricciones = restriccionesUsuario
                        ? receta.restricciones.includes(restriccionesUsuario.toLowerCase())
                        : true;
                    const cumpleObjetivo = receta.objetivos.includes(objetivo);
                    return receta.tipo === comida && cumpleRestricciones && cumpleObjetivo;
                });

                if (recetasFiltradas.length > 0) {
                    const recetaSeleccionada = recetasFiltradas[Math.floor(Math.random() * recetasFiltradas.length)];
                    menuCompleto += `<li><strong>${comida.charAt(0).toUpperCase() + comida.slice(1)}:</strong> ${recetaSeleccionada.nombre} (${recetaSeleccionada.calorias} calorías)</li>`;
                } else {
                    menuCompleto += `<li><strong>${comida.charAt(0).toUpperCase() + comida.slice(1)}:</strong> No hay opciones disponibles para tus restricciones.</li>`;
                }
            });

            menuCompleto += `</ul>`;
            return menuCompleto;
        }

        // Manejar el envío del formulario de nutrición
        const nutricionForm = document.getElementById("nutricionForm");
        if (nutricionForm) {
            nutricionForm.addEventListener("submit", function(event) {
                event.preventDefault();

                // Obtener los datos del formulario
                const nombre = document.getElementById("nombre").value;
                const edad = document.getElementById("edad").value;
                const peso = document.getElementById("peso").value;
                const altura = document.getElementById("altura").value;
                const genero = document.getElementById("genero").value;
                const objetivo = document.getElementById("objetivo").value;
                const restricciones = document.getElementById("restricciones").value;

                // Calcular BMR (Tasa Metabólica Basal)
                const bmr = calcularTMB(peso, altura, edad, genero);

                // Calcular las calorías diarias dependiendo del objetivo
                let caloriasDiarias;
                if (objetivo === "perder_peso") {
                    caloriasDiarias = bmr * 1.2 - 500;
                } else if (objetivo === "ganar_masa") {
                    caloriasDiarias = bmr * 1.5 + 300;
                } else {
                    caloriasDiarias = bmr * 1.2;
                }

                // Mostrar el consumo de agua recomendado
                const ingestaAgua = calcularIngestaAgua(peso);
                const resultadoAgua = document.getElementById("resultadoAgua");
                if (resultadoAgua) {
                    resultadoAgua.textContent = `Te recomendamos beber ${ingestaAgua} litros de agua al día.`;
                }

                // Generar el menú automáticamente
                const menuGenerado = generarMenuAutomatico(caloriasDiarias, restricciones, objetivo);
                const resultadoDieta = document.getElementById("resultadoDieta");
                if (resultadoDieta) {
                    resultadoDieta.innerHTML = menuGenerado;
                }
            });
        }

        // Función para manejar el progreso
        const progresoForm = document.getElementById("progresoForm");
        if (progresoForm) {
            progresoForm.addEventListener("submit", function(event) {
                event.preventDefault();
                const dni = document.getElementById("dni").value;
                const peso = document.getElementById("peso").value;
                const medidaCintura = document.getElementById("medidaCintura").value;
                const medidaCadera = document.getElementById("medidaCadera").value;

                // Guardar el progreso en el localStorage usando el DNI como clave
                const progresoUsuario = {
                    peso,
                    medidaCintura,
                    medidaCadera,
                    fecha: new Date().toLocaleDateString()
                };

                let progresos = JSON.parse(localStorage.getItem(dni)) || [];
                progresos.push(progresoUsuario);
                localStorage.setItem(dni, JSON.stringify(progresos));

                // Mostrar el gráfico de progreso
                mostrarGraficoProgreso(dni);
            });
        }

        // Función para cargar y mostrar el gráfico de progreso del usuario
        function mostrarGraficoProgreso(dni) {
            const progresos = JSON.parse(localStorage.getItem(dni)) || [];
            const datosProgreso = {
                labels: progresos.map((progreso, index) => `Registro ${index + 1}`),
                datasets: [{
                    label: 'Peso (kg)',
                    data: progresos.map(progreso => progreso.peso),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            };

            const ctx = document.getElementById('graficoProgreso');
            if (graficoProgreso) {
                graficoProgreso.destroy();
            }
            if (ctx) {
                graficoProgreso = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: datosProgreso,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
        }

        // Cargar el progreso por DNI
        const cargarProgresoForm = document.getElementById("cargarProgresoForm");
        if (cargarProgresoForm) {
            cargarProgresoForm.addEventListener("submit", function(event) {
                event.preventDefault();
                const dni = document.getElementById("dniCargar").value;
                mostrarGraficoProgreso(dni);
            });
        }
    </script>
</body>
</html>
